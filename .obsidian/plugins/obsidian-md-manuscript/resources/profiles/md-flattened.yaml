# md-flattened.yaml - Flattened markdown for digital gardens and web publishing
# 
# This profile produces clean, web-ready markdown with:
# - All cross-references resolved (Figure 1, Table 1, etc.)
# - Citations rendered with bibliography
# - Figures/tables converted to standard markdown
# - LaTeX-specific code removed
#
# Usage: python build.py --profile=md-flattened --source=your-document.md

profile:
  name: "Flattened Markdown"
  description: "Web-ready markdown with resolved references for digital gardens"
  format: md

# --- Input Settings ---
# Enable mark extension for ==highlighted text== and raw_html for <font color> tags
reader: markdown+mark+raw_html+raw_tex+implicit_figures

# Output Settings ---
# Use gfm (GitHub Flavored Markdown) for better compatibility with web renderers
# and robust emphasis/link parsing.
writer: gfm-tex_math_gfm+raw_html+tex_math_dollars

# Prevent line wrapping (important for clean output)
wrap: none
columns: 10000

# --- Filters ---
# Order matters:
# 1. html-formatting.lua - Normalize HTML formatting tags to AST equivalents
# 2. figure-callouts-md.lua - Convert figure callouts to standard markdown
# 3. table-callouts-md.lua - Convert table callouts to standard markdown  
# 4. pandoc-crossref - Resolve cross-references
# 5. citeproc - Process citations and generate bibliography
# 6. strip-latex.lua - Remove remaining LaTeX code
filters:
  - resources/html-formatting.lua
  - resources/figure-callouts-md.lua
  - resources/table-callouts-md.lua
  - pandoc-crossref
  - citeproc
  - resources/strip-latex.lua

# --- Bibliography ---
bibliography: references.json

# --- Metadata ---
metadata:
  # Disable link-citations for cleaner output (no hyperlinks in bibliography)
  link-citations: false
  
  # Cross-reference settings
  figureTitle: "Figure"
  tableTitle: "Table"
  figPrefix: ["Figure", "Figures"]
  tblPrefix: ["Table", "Tables"]
  
  # Don't create hyperlinks for references (plain text output)
  linkReferences: false
  nameInLink: false
  
  # Custom settings for the markdown filters
  # Note: figure-format is set via command line (--figure-format=png/webp/jpg)
  # to avoid metadata concatenation issues
  number-figures: true
  number-tables: true
  keep-color-as-html: true
  keep-highlighting: true
  visualize-captions: true
  caption-style: html
